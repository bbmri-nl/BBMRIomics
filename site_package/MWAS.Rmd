---
title: "MWAS"
output: 
  html_document:
    highlight: tango
    toc: true
    toc_float:
      collapsed: false
bibliography: BBMRIomics.bib
---


```{r, child="_setup.Rmd"}
```

## connect to database ##

Access to the RP4 metabolites requires an additional account to the
molgenis RP4 database.

**BBMRIomics** provides `molgenis.connect` to connect to the molgenis
database using its
[RESTfull-API](http://molgenis.github.io/documentation) and
`molgenis.get.all` for extraction of the data.


<!-- Dd 2017-03-20 18:26 attempt to execute this chunk yields: -->
<!-- -- -->
<!-- Error in gsub("'", "", usrpwd) : object 'RP4_DB_USRPWD' not found -->
<!-- -- -->
<!-- ==> Set "eval=FALSE" for this chunk (HD). -->
```{r, rp4connect}
# ```{r, rp4connect, eval=FALSE}
library(BBMRIomics)
RP4_DB
molgenis.connect(usrpwd=RP4_DB_USRPWD, url=RP4_DB)
ls()
```

## Extract data ##

If a `molgenis.token` is available in the global environment you are ready to
extract the data.

```{r, getall}
# ```{r, getall, eval=FALSE}
biobanks <- molgenis.get.all("biobanks", verbose = FALSE)
biobanks$abbreviation
table(biobanks$use_of_beta_blockers)
biobanks$abbreviation[biobanks$use_of_beta_blockers]
```

```{r, laclevels}
# ```{r, laclevels, eval=FALSE}
measurements <- molgenis.get.all("measurements")
measurements$biobank <- gsub("-.*$", "", measurements$sample_id)
biobank_ordered <- with(measurements, reorder(biobank, lac, median, na.rm = TRUE))
gp <- ggplot(measurements, aes(biobank_ordered, lac))
gp <- gp + geom_boxplot()
gp <- gp + theme(axis.text.x = element_text(angle = 90, hjust = 0, size = 7))
gp
```

## Run MWAS ##

**TODO** erik?


<!-- END OF FILE. -->
