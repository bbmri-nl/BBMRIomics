---
title: "Exploratory data analysis"
output: 
  html_document:
    highlight: tango
    toc: true
    toc_float:
      collapsed: false
---

```{r, child="_setup.Rmd"}
```

## Inspect data ##

### metadata ###

Load a dataset and inspect the **colData** using
`colData(dataset)`. The `column`-data contains information for each
column. This can be phenotypic information; `Sampling_Age`, `Sex` or
`Height`, blood parameters, such white blood cell counts or
information specific to the omic data-type, e.g. in case of the array
DNA methylation data, `Hydridization_Data`, `Stain_Date`, etc.


<!-- Dd 2017-03-20 18:44, an attempt to run the chunk below yielded: -->
<!-- -- -->
<!-- Error in colData(betas) : object 'betas' not found -->
<!-- Calls: <Anonymous> ... withCallingHandlers -> withVisible -> eval -> eval -> colData -->
<!-- Execution halted -->
<!-- -- -->
<!-- ==> Set "eval=FALSE" for this chunk (HD). -->
<!-- START Code amended from "./EWAS.Rmd" dd 2017-03-20 18:47 (HD). -->
<!-- Execution of chunk below leads to (an) error(s) dd 2017-03-20 16:08, hence set "eval=FALSE" (HD) -->
```{r, coldata}
# ```{r, coldata, eval=FALSE}

#Load 'BBMRIomics' library
library(BBMRIomics)

#Load 'methData_Betas_CODAM_F2_cleaned' data set
#
utils::data(methData_Betas_CODAM_F2_cleaned)
#
#
culprit <- "methData_Betas_CODAM_F2_cleaned"
#
if (exists('last.warning') && last.warning$`d`==paste0("data(", culprit, ")")){
  stop("data set '", culprit, "' not found")
}


cData <- colData(betas)
cData[1:5, 1:5]
```

Tabulation can be used for inspection of the distribution of categorical variables.

```{r, tabulatecoldata}
# ```{r, tabulatecoldata, eval=FALSE}
xtabs(~Sex+Smoking, data=as.data.frame(cData))
```

Use plots for example, a histogram for inspection of the `Sampling_Age`
distribution.

```{r, plotcoldata}
# ```{r, plotcoldata, eval=FALSE}
library(ggplot2)
qplot(Sampling_Age, data=as.data.frame(cData), geom="histogram")
summary(cData$Sampling_Age)
```

Optionally stratify by `Sex`.


```{r, plotcoldatastratified}
# ```{r, plotcoldatastratified, eval=FALSE}
gp <- ggplot(as.data.frame(cData), aes(x=Sampling_Age))
gp <- gp + geom_histogram()
gp + facet_grid(Sex~.)
```

### feature annotation ###

For array DNA methylation the `rowRanges` contain the probe
information provide by the
[**FDb.InfiniumMethylation.hg19**](http://bioconductor.org/packages/release/data/annotation/manuals/FDb.InfiniumMethylation.hg19/man/FDb.InfiniumMethylation.hg19.pdf)
Bioconductor annotation package. This package contains the same
information as the Illumina Human DNA methylation 450k manifest file
but in a convenient format, as `GRanges`-object.

```{r, rowdata}
# ```{r, rowdata, eval=FALSE}
SummarizedExperiment::rowRanges(betas)
```

### features ###

```{r, assaydata}
# ```{r, assaydata, eval=FALSE}
data <- assays(betas)$data
data[1:5, 1:5]
```

```{r}
# ```{r, eval=FALSE}
hist(data[1,], xlim=c(0, 1), main=paste("beta-value distribution for probe:", rownames(data)[1]))
```

## Exploratory plots ##

See [**irlba**](https://cran.r-project.org/web/packages/irlba/vignettes/irlba.pdf)

```{r, pca}
# ```{r, pca, eval=FALSE}
library(irlba)

utils::data(rnaSeqData_ReadCounts_BIOS_cleaned)
#
#
culprit <- "rnaSeqData_ReadCounts_BIOS_cleaned"
#
if (exists('last.warning') && last.warning$`d`==paste0("data(", culprit, ")")){
  stop("data set '", culprit, "' not found")
}


library(edgeR)
y <- DGEList(assays(counts)$data, remove.zeros=TRUE)
y <- calcNormFactors(y)
y <- cpm(y, log=TRUE)
pc <- prcomp_irlba(t(y))
summary(pc)
plot(pc$x, col=ifelse(colData(counts)$Sex == "Female", 1, 2))
```

```{r, pcabiobank}
# ```{r, pcabiobank, eval=FALSE}
biobank <- factor(colData(counts)$biobank_id)
plot(pc$x, col=adjustcolor(as.integer(biobank), alpha.f = 0.3), pch=16)
legend("topleft", levels(biobank), col=adjustcolor(1:nlevels(biobank), alpha.f = 0.3), pch=16, bty="n")     
```


<!-- END OF FILE. -->
